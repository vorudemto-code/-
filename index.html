<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç«¶è¼ªé¸æ‰‹ãƒ¡ãƒ¢å¸³</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;

    // Lucide icons as inline SVG
    const Trash2 = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6"/>
      </svg>
    );

    const Plus = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
    );

    const Download = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/>
      </svg>
    );

    const Copy = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
      </svg>
    );

    const Check = ({ size = 16 }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="20 6 9 17 4 12"/>
      </svg>
    );

    function KeirinMemo() {
      const symbols = ['â—', 'â—‹', 'â–³', 'Ã—', 'ï¼'];
      const buildTypes = ['è‡ªåˆ†å„ªå…ˆ', 'ãƒ©ã‚¤ãƒ³è²¢çŒ®', 'ç©æ¥µå…ˆè¡Œ', 'â—', 'â—‹', 'â–³', 'Ã—', 'ï¼', 'åŒçœŒé€£æºãªã‚‰ã€‡', 'åœ°å…ƒå‹¢ã„ãŸã‚‰ã€‡', 'åœ°å…ƒã€åŒçœŒå‹¢ã„ãŸã‚‰ã€‡'];
      const straightSpeedTypes = ['â—', 'â—‹', 'â–³', 'Ã—', 'ï¼'];
      const soloEvaluationTypes = ['è‡ªåŠ›ãƒ¡ã‚¤ãƒ³', 'è‡ªåœ¨ãƒ¡ã‚¤ãƒ³', 'å±•é–‹å¾…ã¡', 'åœ°è”µ', 'ä¸æ˜'];
      const classes = ['SS', 'S1', 'S2', 'A1', 'A2', 'A3', 'ã‚¬ãƒ¼ãƒ«ã‚º'];
      const prefectures = ['åŒ—æµ·é“', 'é’æ£®', 'å²©æ‰‹', 'å®®åŸ', 'ç§‹ç”°', 'å±±å½¢', 'ç¦å³¶', 'èŒ¨åŸ', 'æ ƒæœ¨', 'ç¾¤é¦¬', 'åŸ¼ç‰', 'åƒè‘‰', 'æ±äº¬', 'ç¥å¥ˆå·', 'æ–°æ½Ÿ', 'å¯Œå±±', 'çŸ³å·', 'ç¦äº•', 'å±±æ¢¨', 'é•·é‡', 'å²é˜œ', 'é™å²¡', 'æ„›çŸ¥', 'ä¸‰é‡', 'æ»‹è³€', 'äº¬éƒ½', 'å¤§é˜ª', 'å…µåº«', 'å¥ˆè‰¯', 'å’Œæ­Œå±±', 'é³¥å–', 'å³¶æ ¹', 'å²¡å±±', 'åºƒå³¶', 'å±±å£', 'å¾³å³¶', 'é¦™å·', 'æ„›åª›', 'é«˜çŸ¥', 'ç¦å²¡', 'ä½è³€', 'é•·å´', 'ç†Šæœ¬', 'å¤§åˆ†', 'å®®å´', 'é¹¿å…å³¶', 'æ²–ç¸„'];

      const [activeClass, setActiveClass] = useState('S1');
      const [copied, setCopied] = useState(false);
      const [searchTerm, setSearchTerm] = useState('');
      const [filterPrefecture, setFilterPrefecture] = useState('all');
      const [expandedEvaluation, setExpandedEvaluation] = useState(null);
      const [loading, setLoading] = useState(true);
      const [showComparison, setShowComparison] = useState(false);
      const [checkedPlayers, setCheckedPlayers] = useState(new Set());
      const [sortType, setSortType] = useState('name');

      const [players, setPlayers] = useState([
        { id: 1, name: 'å¸‚ç”°é›„', class: 'SS', prefecture: 'åŒ—æµ·é“', period: '178', speed: 'â—', stamina: 'â—‹', strength: 'â—‹', build: 'â—‹', evaluation: 'ãƒ‡ãƒ“ãƒ¥ãƒ¼å¾Œã‚‚çµ¶å¥½èª¿ã€‚ãƒ©ã‚¤ãƒ³ã®æ„è­˜ã‚‚é«˜ã„åŠ›å¼·ã•', straightSpeed: 'â—', soloEvaluation: 'è‡ªåŠ›ãƒ¡ã‚¤ãƒ³' },
        { id: 2, name: 'å°¾é‡ç¿”ä¸€', class: 'A1', prefecture: 'æ±äº¬', period: '176', speed: 'â—‹', stamina: 'â—‹', strength: 'â—‹', build: 'â—‹', evaluation: 'å¼·ã„ã®ã¯ã‚ã‹ã‚‹ã‘ã©çµ„ã¿ç«‹ã¦ã§å­ã¶ï¼Ÿã‚‚ã—ã‹ã—ã¦è„šçš„åŠ›ï¼Ÿ', straightSpeed: 'â—‹', soloEvaluation: 'è‡ªåœ¨ãƒ¡ã‚¤ãƒ³' }
      ]);

      const [newPlayer, setNewPlayer] = useState({
        name: '', class: 'SS', prefecture: 'åŒ—æµ·é“', period: '', speed: 'â—‹', stamina: 'â—‹', strength: 'â—‹', build: 'â—‹', straightSpeed: 'â—', soloEvaluation: 'è‡ªåŠ›ãƒ¡ã‚¤ãƒ³', evaluation: ''
      });

      const initDB = async () => {
        return new Promise((resolve, reject) => {
          const request = indexedDB.open('KeirinMemoDB', 1);
          request.onerror = () => reject(request.error);
          request.onsuccess = () => resolve(request.result);
          request.onupgradeneeded = (event) => {
            const db = event.target.result;
            if (!db.objectStoreNames.contains('players')) {
              db.createObjectStore('players', { keyPath: 'id' });
            }
          };
        });
      };

      const loadPlayers = async () => {
        try {
          const db = await initDB();
          return new Promise((resolve) => {
            const transaction = db.transaction('players', 'readonly');
            const store = transaction.objectStore('players');
            const request = store.getAll();
            request.onsuccess = () => {
              const data = request.result;
              resolve(data.length > 0 ? data : null);
            };
          });
        } catch (error) {
          console.error('DBèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
          return null;
        }
      };

      const saveToDb = async (playersData) => {
        try {
          const db = await initDB();
          const transaction = db.transaction('players', 'readwrite');
          const store = transaction.objectStore('players');
          store.clear();
          playersData.forEach(player => store.put(player));
          return new Promise((resolve) => {
            transaction.oncomplete = () => resolve(true);
          });
        } catch (error) {
          console.error('DBä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      useEffect(() => {
        const initialize = async () => {
          const savedPlayers = await loadPlayers();
          if (savedPlayers) setPlayers(savedPlayers);
          setLoading(false);
        };
        initialize();
      }, []);

      const saveTimerRef = useRef(null);

      const debouncedSave = (data) => {
        if (saveTimerRef.current) clearTimeout(saveTimerRef.current);
        saveTimerRef.current = setTimeout(() => saveToDb(data), 500);
      };

      const addPlayer = () => {
        if (newPlayer.name.trim()) {
          const updatedPlayers = [...players, { ...newPlayer, id: Date.now() }];
          setPlayers(updatedPlayers);
          saveToDb(updatedPlayers);
          setNewPlayer({ name: '', class: activeClass, prefecture: 'åŒ—æµ·é“', period: '', speed: 'â—‹', stamina: 'â—‹', strength: 'â—‹', build: 'â—‹', straightSpeed: 'â—', soloEvaluation: 'è‡ªåŠ›ãƒ¡ã‚¤ãƒ³', evaluation: '' });
        }
      };

      const updatePlayer = (id, field, value) => {
        const updatedPlayers = players.map(p => p.id === id ? { ...p, [field]: value } : p);
        setPlayers(updatedPlayers);
        debouncedSave(updatedPlayers);
      };

      const removePlayer = (id) => {
        const updatedPlayers = players.filter(p => p.id !== id);
        setPlayers(updatedPlayers);
        saveToDb(updatedPlayers);
        const newChecked = new Set(checkedPlayers);
        newChecked.delete(id);
        setCheckedPlayers(newChecked);
      };

      const toggleCheckbox = (id) => {
        const newChecked = new Set(checkedPlayers);
        if (newChecked.has(id)) {
          newChecked.delete(id);
        } else {
          newChecked.add(id);
        }
        setCheckedPlayers(newChecked);
      };

      const getComparisonPlayers = () => players.filter(p => checkedPlayers.has(p.id));

      const filteredPlayers = useMemo(() => 
        players.filter(p => 
          p.class === activeClass && 
          p.name.toLowerCase().includes(searchTerm.toLowerCase()) &&
          (filterPrefecture === 'all' || p.prefecture === filterPrefecture)
        ), [players, activeClass, searchTerm, filterPrefecture]
      );

      const getSortedPlayers = useMemo(() => {
        const sorted = [...filteredPlayers];
        return sortType === 'name' 
          ? sorted.sort((a, b) => a.name.localeCompare(b.name, 'ja'))
          : sorted.sort((a, b) => a.prefecture.localeCompare(b.prefecture, 'ja'));
      }, [filteredPlayers, sortType]);

      const getClassColor = (cls) => {
        const colors = { SS: 'bg-red-900 text-white', S1: 'bg-red-700 text-white', S2: 'bg-red-600 text-white', A1: 'bg-blue-700 text-white', A2: 'bg-blue-600 text-white', A3: 'bg-blue-500 text-white', ã‚¬ãƒ¼ãƒ«ã‚º: 'bg-pink-600 text-white' };
        return colors[cls] || 'bg-gray-600 text-white';
      };

      const getClassBgColor = (cls) => {
        if (['SS', 'S1', 'S2'].includes(cls)) return 'bg-red-50 border-red-200';
        if (['A1', 'A2', 'A3'].includes(cls)) return 'bg-blue-50 border-blue-200';
        if (cls === 'ã‚¬ãƒ¼ãƒ«ã‚º') return 'bg-pink-50 border-pink-200';
        return 'bg-gray-50';
      };

      const getSymbolColor = (symbol) => {
        const colors = { 'â—': 'text-red-600 font-bold', 'â—‹': 'text-blue-600 font-semibold', 'â–³': 'text-yellow-600 font-semibold', 'Ã—': 'text-gray-400', 'ï¼': 'text-gray-300' };
        return colors[symbol] || '';
      };

      const downloadData = () => {
        try {
          const dataStr = JSON.stringify(players, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `keirin_memo_${new Date().toISOString().split('T')[0]}.json`;
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          URL.revokeObjectURL(url);
        } catch (error) {
          console.error('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
          alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        }
      };

      const importData = (event) => {
        const file = event.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async (e) => {
          try {
            const importedData = JSON.parse(e.target.result);
            if (!Array.isArray(importedData)) {
              alert('âŒ ç„¡åŠ¹ãªãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™');
              return;
            }
            const shouldMerge = confirm(`ğŸ“¥ ${importedData.length}åã®é¸æ‰‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚\n\nç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿: ${players.length}å\nã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿: ${importedData.length}å\n\nã€ŒOKã€= æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã«è¿½åŠ \nã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€= æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç½®ãæ›ãˆ`);
            let newPlayers;
            if (shouldMerge) {
              const importedWithNewIds = importedData.map(p => ({ ...p, id: Date.now() + Math.random() }));
              newPlayers = [...players, ...importedWithNewIds];
            } else {
              newPlayers = importedData;
            }
            setPlayers(newPlayers);
            await saveToDb(newPlayers);
            alert(`âœ… ã‚¤ãƒ³ãƒãƒ¼ãƒˆå®Œäº†ï¼ ${newPlayers.length}åã®é¸æ‰‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚`);
          } catch (error) {
            console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
            alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
          }
        };
        reader.readAsText(file);
        event.target.value = '';
      };

      const copyToClipboard = () => {
        const summary = players.map(p => `${p.name} (${p.class}) - Period:${p.period} Speed:${p.speed} Stamina:${p.stamina} - ${p.evaluation}`).join('\n');
        navigator.clipboard.writeText(summary);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      if (loading) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 flex items-center justify-center">
            <div className="text-center">
              <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
              <p className="text-slate-600">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 md:p-6">
          <div className="max-w-full mx-auto">
            <div className="flex justify-between items-start mb-6 flex-col md:flex-row gap-4">
              <div>
                <h1 className="text-3xl md:text-4xl font-bold text-slate-800 mb-2">ğŸ“‹ ç«¶è¼ªé¸æ‰‹ãƒ¡ãƒ¢å¸³</h1>
                <p className="text-slate-600">é¸æ‰‹ã®èƒ½åŠ›ã¨ç‰¹å¾´ã‚’åˆ†é¡åˆ¥ã«ç®¡ç†ãƒ»ãƒ¡ãƒ¢ã§ãã¾ã™</p>
              </div>
              <div className="flex gap-2 flex-wrap">
                <button onClick={() => setShowComparison(!showComparison)} disabled={checkedPlayers.size === 0} className={`px-4 py-2 rounded-lg flex items-center gap-2 transition text-sm font-semibold ${checkedPlayers.size === 0 ? 'bg-gray-300 text-gray-600 cursor-not-allowed' : showComparison ? 'bg-purple-600 hover:bg-purple-700 text-white' : 'bg-purple-500 hover:bg-purple-600 text-white'}`}>
                  ğŸ” æ¯”è¼ƒ ({checkedPlayers.size})
                </button>
                <button onClick={copyToClipboard} className="bg-slate-600 hover:bg-slate-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition text-sm">
                  {copied ? <Check size={16} /> : <Copy size={16} />}
                  {copied ? 'ã‚³ãƒ”ãƒ¼æ¸ˆã¿' : 'ã‚³ãƒ”ãƒ¼'}
                </button>
                <label className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition text-sm cursor-pointer">
                  <Plus size={16} /> ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
                  <input type="file" accept=".json" onChange={importData} className="hidden" />
                </label>
                <button onClick={downloadData} className="bg-slate-700 hover:bg-slate-800 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition text-sm">
                  <Download size={16} /> ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
              </div>
            </div>

            {showComparison && checkedPlayers.size > 0 && (
              <div className="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4 overflow-y-auto">
                <div className="bg-white rounded-lg shadow-2xl p-6 w-full max-w-7xl my-8">
                  <div className="flex justify-between items-center mb-6">
                    <h2 className="text-3xl font-bold text-purple-900">ğŸ” é¸æ‰‹æ¯”è¼ƒï¼ˆ{checkedPlayers.size}åï¼‰</h2>
                    <button onClick={() => setShowComparison(false)} className="text-gray-500 hover:text-gray-700 text-3xl font-bold transition">âœ•</button>
                  </div>
                  <div className="overflow-x-auto">
                    <table className="w-full border-collapse">
                      <thead>
                        <tr className="bg-gradient-to-r from-purple-600 to-purple-700 text-white">
                          <th className="border border-purple-400 px-4 py-4 text-left font-bold">é …ç›®</th>
                          {getComparisonPlayers().map(player => (
                            <th key={player.id} className="border border-purple-400 px-6 py-4 text-center font-bold min-w-56">
                              <div className={`font-bold mb-2 px-3 py-1 rounded text-white text-sm inline-block ${getClassColor(player.class)}`}>{player.class}</div>
                              <div className="text-lg whitespace-nowrap">{player.name}</div>
                            </th>
                          ))}
                        </tr>
                      </thead>
                      <tbody>
                        {[
                          { label: 'æœŸ', key: 'period', size: 'text-lg' },
                          { label: 'ã‚¹ãƒ”ãƒ¼ãƒ‰', key: 'speed', size: 'text-4xl', useColor: true },
                          { label: 'ã‚¹ã‚¿ãƒŸãƒŠ', key: 'stamina', size: 'text-4xl', useColor: true },
                          { label: 'æ¨ªã®å¼·ã•', key: 'strength', size: 'text-4xl', useColor: true, default: 'â—‹' },
                          { label: 'çµ„ã¿ç«‹ã¦', key: 'build', size: 'text-lg', default: 'â—‹' },
                          { label: 'Sã®é€Ÿã•', key: 'straightSpeed', size: 'text-lg', useColor: true, default: 'â—' },
                          { label: 'å˜é¨è©•ä¾¡', key: 'soloEvaluation', size: 'text-lg', default: 'è‡ªåŠ›ãƒ¡ã‚¤ãƒ³' }
                        ].map((row, idx) => (
                          <tr key={row.key} className={idx % 2 === 0 ? 'bg-purple-50' : 'bg-white'}>
                            <td className="border border-purple-300 px-4 py-4 font-bold text-slate-700 bg-purple-100">{row.label}</td>
                            {getComparisonPlayers().map(player => (
                              <td key={player.id} className={`border border-purple-300 px-6 py-4 text-center ${idx % 2 === 0 ? 'hover:bg-white' : 'hover:bg-purple-50'} transition`}>
                                <span className={`${row.size} font-bold ${row.useColor ? getSymbolColor(player[row.key] || row.default) : 'text-slate-700'}`}>
                                  {player[row.key] || row.default || 'ï¼'}
                                </span>
                              </td>
                            ))}
                          </tr>
                        ))}
                        <tr className="bg-white">
                          <td className="border border-purple-300 px-4 py-4 font-bold text-slate-700 bg-purple-100">è©•ä¾¡ãƒ»ç‰¹å¾´</td>
                          {getComparisonPlayers().map(player => (
                            <td key={player.id} className="border border-purple-300 px-6 py-4 text-sm hover:bg-purple-50 transition">
                              <div className="text-slate-700 whitespace-pre-wrap max-h-48 overflow-y-auto">{player.evaluation || 'ãªã—'}</div>
                            </td>
                          ))}
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div className="mt-6 flex justify-end">
                    <button onClick={() => setShowComparison(false)} className="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-semibold transition">é–‰ã˜ã‚‹</button>
                  </div>
                </div>
              </div>
            )}

            <div className="flex gap-2 mb-6 flex-wrap">
              {classes.map(cls => (
                <button key={cls} onClick={() => { setActiveClass(cls); setNewPlayer({ ...newPlayer, class: cls }); }} className={`px-6 py-3 font-bold rounded-lg text-lg transition ${activeClass === cls ? `${getClassColor(cls)} shadow-lg` : 'bg-white text-slate-700 border-2 border-slate-300 hover:border-slate-400'}`}>
                  {cls} ({players.filter(p => p.class === cls).length})
                </button>
              ))}
            </div>

            <div className="mb-6 flex gap-3 flex-col md:flex-row">
              <input type="text" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} placeholder="é¸æ‰‹ã‚’æ¤œç´¢..." className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm" />
              <select value={filterPrefecture} onChange={(e) => setFilterPrefecture(e.target.value)} className="md:w-48 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm font-semibold bg-white">
                <option value="all">ğŸ“ æ‰€å±ï¼šã™ã¹ã¦</option>
                {prefectures.map(pref => <option key={pref} value={pref}>ğŸ“ æ‰€å±ï¼š{pref}</option>)}
              </select>
            </div>

            <div className={`rounded-lg shadow-md p-4 md:p-6 mb-6 border-l-4 ${getClassBgColor(activeClass)}`}>
              <h2 className="text-lg font-bold text-slate-700 mb-4">æ–°è¦é¸æ‰‹ã‚’è¿½åŠ </h2>
              <div className="grid grid-cols-2 md:grid-cols-7 gap-3">
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">é¸æ‰‹å</label>
                  <input type="text" value={newPlayer.name} onChange={(e) => setNewPlayer({ ...newPlayer, name: e.target.value })} onKeyPress={(e) => e.key === 'Enter' && addPlayer()} placeholder="é¸æ‰‹å" className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm" />
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">ã‚¯ãƒ©ã‚¹</label>
                  <select value={newPlayer.class} onChange={(e) => setNewPlayer({ ...newPlayer, class: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm font-semibold">
                    {classes.map(cls => <option key={cls} value={cls}>{cls}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">æ‰€å±</label>
                  <select value={newPlayer.prefecture} onChange={(e) => setNewPlayer({ ...newPlayer, prefecture: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm font-semibold">
                    {prefectures.map(pref => <option key={pref} value={pref}>{pref}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">æœŸ</label>
                  <input type="text" value={newPlayer.period} onChange={(e) => setNewPlayer({ ...newPlayer, period: e.target.value.slice(0, 3) })} onKeyPress={(e) => e.key === 'Enter' && addPlayer()} placeholder="ä¾‹ï¼š178" maxLength="3" className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm text-center font-semibold" />
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">ã‚¹ãƒ”ãƒ¼ãƒ‰</label>
                  <select value={newPlayer.speed} onChange={(e) => setNewPlayer({ ...newPlayer, speed: e.target.value })} className={`w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-base font-semibold ${getSymbolColor(newPlayer.speed)}`}>
                    {symbols.map(s => <option key={s} value={s}>{s}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">ã‚¹ã‚¿ãƒŸãƒŠ</label>
                  <select value={newPlayer.stamina} onChange={(e) => setNewPlayer({ ...newPlayer, stamina: e.target.value })} className={`w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-base font-semibold ${getSymbolColor(newPlayer.stamina)}`}>
                    {symbols.map(s => <option key={s} value={s}>{s}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">æ¨ªã®å¼·ã•</label>
                  <select value={newPlayer.strength} onChange={(e) => setNewPlayer({ ...newPlayer, strength: e.target.value })} className={`w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-base font-semibold ${getSymbolColor(newPlayer.strength)}`}>
                    {symbols.map(s => <option key={s} value={s}>{s}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">çµ„ã¿ç«‹ã¦</label>
                  <select value={newPlayer.build} onChange={(e) => setNewPlayer({ ...newPlayer, build: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm font-semibold bg-white">
                    {buildTypes.map(b => <option key={b} value={b}>{b}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">Sã®é€Ÿã•</label>
                  <select value={newPlayer.straightSpeed} onChange={(e) => setNewPlayer({ ...newPlayer, straightSpeed: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm font-semibold bg-white">
                    {straightSpeedTypes.map(s => <option key={s} value={s}>{s}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">å˜é¨è©•ä¾¡</label>
                  <select value={newPlayer.soloEvaluation} onChange={(e) => setNewPlayer({ ...newPlayer, soloEvaluation: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm font-semibold bg-white">
                    {soloEvaluationTypes.map(s => <option key={s} value={s}>{s}</option>)}
                  </select>
                </div>
                <div>
                  <label className="block text-xs text-slate-600 font-semibold mb-1">ç‰¹å¾´ãƒ»è©•ä¾¡</label>
                  <textarea value={newPlayer.evaluation} onChange={(e) => setNewPlayer({ ...newPlayer, evaluation: e.target.value })} placeholder="ç‰¹å¾´ãƒ»è©•ä¾¡" className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-2 focus:ring-blue-200 text-sm resize-vertical min-h-[42px]" rows="1" />
                </div>
                <div className="col-span-2 md:col-span-1 flex items-end">
                  <button onClick={addPlayer} className="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 rounded flex items-center justify-center gap-1 text-sm transition">
                    <Plus size={16} /> è¿½åŠ 
                  </button>
                </div>
              </div>
            </div>

            <div className="overflow-x-auto bg-white rounded-lg shadow-md border-t-4" style={{ borderTopColor: activeClass.startsWith('S') || activeClass === 'SS' ? '#dc2626' : activeClass === 'ã‚¬ãƒ¼ãƒ«ã‚º' ? '#ec4899' : '#2563eb' }}>
              <table className="w-full border-collapse">
                <thead>
                  <tr className={`text-white ${activeClass.startsWith('S') || activeClass === 'SS' ? 'bg-red-600' : activeClass === 'ã‚¬ãƒ¼ãƒ«ã‚º' ? 'bg-pink-600' : 'bg-blue-600'}`}>
                    <th className="border border-slate-300 px-2 py-3 text-center font-bold text-sm w-10">æ¯”è¼ƒ</th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-20">ã‚¯ãƒ©ã‚¹</th>
                    <th className="border border-slate-300 px-3 py-3 text-left font-bold text-sm w-32">
                      <button onClick={() => setSortType('name')} className={`flex items-center gap-1 transition ${sortType === 'name' ? 'underline' : 'opacity-70 hover:opacity-100'}`}>
                        é¸æ‰‹ {sortType === 'name' ? 'â†“' : ''}
                      </button>
                    </th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-24">
                      <button onClick={() => setSortType('prefecture')} className={`flex items-center gap-1 justify-center transition ${sortType === 'prefecture' ? 'underline' : 'opacity-70 hover:opacity-100'}`}>
                        æ‰€å± {sortType === 'prefecture' ? 'â†“' : ''}
                      </button>
                    </th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-14">æœŸ</th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-20">ã‚¹ãƒ”ãƒ¼ãƒ‰</th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-20">ã‚¹ã‚¿ãƒŸãƒŠ</th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-20">æ¨ªã®å¼·ã•</th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-20">çµ„ã¿ç«‹ã¦</th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-24">Sã®é€Ÿã•</th>
                    <th className="border border-slate-300 px-3 py-3 text-center font-bold text-sm w-24">å˜é¨è©•ä¾¡</th>
                    <th className="border border-slate-300 px-3 py-3 text-left font-bold text-sm flex-1">ç‰¹å¾´ãƒ»è©•ä¾¡</th>
                    <th className="border border-slate-300 px-2 py-3 text-center font-bold text-sm w-10">å‰Šé™¤</th>
                  </tr>
                </thead>
                <tbody>
                  {getSortedPlayers.map((player, idx) => (
                    <tr key={player.id} className={`${checkedPlayers.has(player.id) ? 'bg-purple-100 border-l-4 border-purple-600' : idx % 2 === 0 ? 'bg-white' : 'bg-slate-50'}`}>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <input type="checkbox" checked={checkedPlayers.has(player.id)} onChange={() => toggleCheckbox(player.id)} className="w-5 h-5 cursor-pointer accent-purple-600" />
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.class} onChange={(e) => updatePlayer(player.id, 'class', e.target.value)} className="w-full text-center px-2 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-sm font-semibold">
                          {classes.map(cls => <option key={cls} value={cls}>{cls}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3">
                        <div className="flex gap-1 items-center">
                          <input type="text" value={player.name} onChange={(e) => updatePlayer(player.id, 'name', e.target.value.slice(0, 7))} className="w-24 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-sm" maxLength="7" />
                          <button onClick={() => setExpandedEvaluation(expandedEvaluation === player.id ? null : player.id)} className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition">â†“</button>
                        </div>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.prefecture} onChange={(e) => updatePlayer(player.id, 'prefecture', e.target.value)} className="w-full text-center px-2 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-sm font-semibold">
                          {prefectures.map(pref => <option key={pref} value={pref}>{pref}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <input type="text" value={player.period} onChange={(e) => updatePlayer(player.id, 'period', e.target.value.slice(0, 3))} maxLength="3" className="w-12 px-2 py-1 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-sm text-center font-semibold" />
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.speed} onChange={(e) => updatePlayer(player.id, 'speed', e.target.value)} className={`w-full text-center px-1 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-lg font-semibold ${getSymbolColor(player.speed)}`}>
                          {symbols.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.stamina} onChange={(e) => updatePlayer(player.id, 'stamina', e.target.value)} className={`w-full text-center px-1 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-lg font-semibold ${getSymbolColor(player.stamina)}`}>
                          {symbols.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.strength} onChange={(e) => updatePlayer(player.id, 'strength', e.target.value)} className={`w-full text-center px-1 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-lg font-semibold ${getSymbolColor(player.strength)}`}>
                          {symbols.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.build} onChange={(e) => updatePlayer(player.id, 'build', e.target.value)} className="w-full text-center px-1 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-sm font-semibold bg-white">
                          {buildTypes.map(b => <option key={b} value={b}>{b}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.straightSpeed || 'â—'} onChange={(e) => updatePlayer(player.id, 'straightSpeed', e.target.value)} className={`w-full text-center px-1 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-sm font-semibold bg-white ${getSymbolColor(player.straightSpeed)}`}>
                          {straightSpeedTypes.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-3 md:px-4 py-3 text-center">
                        <select value={player.soloEvaluation || 'è‡ªåŠ›ãƒ¡ã‚¤ãƒ³'} onChange={(e) => updatePlayer(player.id, 'soloEvaluation', e.target.value)} className="w-full text-center px-1 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-200 text-sm font-semibold bg-white">
                          {soloEvaluationTypes.map(s => <option key={s} value={s}>{s}</option>)}
                        </select>
                      </td>
                      <td className="border border-slate-300 px-2 py-3 max-w-xs">
                        <div className="flex gap-1 items-start">
                          <div className="flex-1">
                            {expandedEvaluation === player.id ? (
                              <textarea value={player.evaluation} onChange={(e) => updatePlayer(player.id, 'evaluation', e.target.value)} className="w-full px-2 py-2 border border-blue-500 rounded focus:outline-none focus:ring-2 focus:ring-blue-300 text-xs min-h-24 bg-blue-50 resize-vertical" placeholder="è©³ç´°ãªè©•ä¾¡ã‚„ãƒ¡ãƒ¢..." />
                            ) : (
                              <div className="text-xs text-gray-700 whitespace-pre-wrap break-words">{player.evaluation || <span className="text-gray-400">ã‚¯ãƒªãƒƒã‚¯ã—ã¦ç·¨é›†</span>}</div>
                            )}
                          </div>
                          <button onClick={() => setExpandedEvaluation(expandedEvaluation === player.id ? null : player.id)} className="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition mt-1 flex-shrink-0">
                            {expandedEvaluation === player.id ? 'â–³' : 'â†“'}
                          </button>
                        </div>
                      </td>
                      <td className="border border-slate-300 px-2 py-3 text-center">
                        <button onClick={() => removePlayer(player.id)} className="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-sm transition">
                          <Trash2 size={16} />
                        </button>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>

            {filteredPlayers.length === 0 && (
              <div className="text-center py-8 text-slate-500 bg-white rounded-lg mt-4">
                <p>{searchTerm ? `ã€Œ${searchTerm}ã€ã«ä¸€è‡´ã™ã‚‹é¸æ‰‹ãŒã‚ã‚Šã¾ã›ã‚“` : `${activeClass}ã®é¸æ‰‹ãŒã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚`}</p>
              </div>
            )}

            <div className="mt-6 pt-4 border-t border-slate-300">
              <p className="text-sm text-slate-600 font-semibold">
                <span className="text-red-900">SS:</span> {players.filter(p => p.class === 'SS').length}å / 
                <span className="text-red-700 ml-2">S1:</span> {players.filter(p => p.class === 'S1').length}å / 
                <span className="text-red-600 ml-2">S2:</span> {players.filter(p => p.class === 'S2').length}å / 
                <span className="text-blue-700 ml-2">A1:</span> {players.filter(p => p.class === 'A1').length}å / 
                <span className="text-blue-600 ml-2">A2:</span> {players.filter(p => p.class === 'A2').length}å / 
                <span className="text-blue-500 ml-2">A3:</span> {players.filter(p => p.class === 'A3').length}å / 
                <span className="text-pink-600 ml-2">ã‚¬ãƒ¼ãƒ«ã‚º:</span> {players.filter(p => p.class === 'ã‚¬ãƒ¼ãƒ«ã‚º').length}å
              </p>
              <p className="text-xs text-slate-500 mt-2">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•çš„ã«ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™</p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<KeirinMemo />, document.getElementById('root'));
  </script>
</body>
</html>
